# 一些你需要记住的快捷键

## 快速 fzf 搜索

ALT + c || CTRL + t

## 快速历史命令查询

ALT + r
非常好！`mtr` 和 `gping` 是极大提升网络诊断效率的利器。为了让你能快速上手并熟练使用它们，我为你制作了一份精炼的命令备忘录 (Cheat Sheet)。

建议将此笔记保存起来，方便随时查阅。

-----
## --- My Custom Network Aliases ---

### 为 gping 创建一个更短的别名
alias gp='gping'

### 为 mtr 创建一个别名，直接进入报告模式 (执行10次后退出并显示总结) 这对于写脚本或者快速获取总结报告非常有用
alias mtrr='mtr --report -c 10'

### 为 mtr 创建一个强制使用 IPv4 的别名
alias mtr4='mtr -4'

### 为 mtr 创建一个强制使用 IPv6 的别名
alias mtr6='mtr -6'

### **🚀 mtr & gping 命令备忘录 (Cheat Sheet)**

-----

### **`mtr` (My Traceroute) - 动态路由诊断神器**

`mtr` 结合了 `ping` 和 `traceroute` 的优点，能实时、持续地监控到目标主机的网络路径质量。

#### **1. 基础用法**

启动一个到目标主机的实时诊断会话：

```bash
mtr google.com
```

按下 `q` 键退出。

#### **2. 如何解读输出界面 📊**

`mtr` 的交互界面是最强大的部分，看懂每一列是关键：

| 列名 (Column) | 解释 | 重要性 |
| :--- | :--- | :--- |
| **Host** | 路径上的路由器节点（主机名或IP地址） | ★★★★★ |
| **Loss%** | **丢包率**。这是最重要的指标！任何非零值都值得关注。 | ★★★★★ |
| **Snt** | 已发送的数据包 (Sent) 数量。 | ★★★☆☆ |
| **Last** | 最后一个数据包的延迟 (ms)。 | ★★★☆☆ |
| **Avg** | **平均延迟** (ms)。这是衡量节点网络质量的核心指标。 | ★★★★★ |
| **Best** | 最佳 (最小) 延迟 (ms)。 | ★★☆☆☆ |
| **Wrst** | 最差 (最大) 延迟 (ms)。 | ★★★★☆ |
| **StDev** | 延迟的标准差。值越高说明延迟越不稳定、抖动越大。 | ★★★★☆ |

**分析技巧**：

  * **从上往下看**，观察延迟在哪里开始**第一次剧增**，这通常是跨国或跨运营商的节点。
  * **关注 `Loss%`**，如果某一跳开始出现持续的丢包，并**影响到后续所有跳**，那么问题很可能出在那个节点或其前一个节点。

#### **3. 交互模式快捷键 ⌨️**

在 `mtr` 运行的界面中，可以按以下按键：

  * `q` : 退出 `mtr`。
  * `h` : 显示帮助菜单。
  * `d` : 切换显示模式 (主机名 \<-\> IP 地址 \<-\> 两者都显示)。
  * `r` : 重置所有计数器。
  * `p` : 暂停/继续发送数据包。

#### **4. 常用命令行选项 (启动时使用)**

| 选项 | 说明 | 适用场景 |
| :--- | :--- | :--- |
| `-r` \<br\> `--report` | **报告模式**。启动 `mtr`，发送10个包，然后生成一份静态报告并退出。 | **必学！** 用于脚本、自动化或快速生成一份可复制分享的诊断报告。 |
| `-c COUNT` \<br\> `--report-cycles COUNT` | 结合 `-r` 使用，指定发送数据包的数量。 | 需要更长时间或更精确的报告时。例如: `mtr -r -c 100 google.com` |
| `-4` / `-6` | 强制使用 IPv4 / IPv6。 | 当你需要诊断特定协议的连通性时。 |
| `-n` \<br\> `--no-dns` | 直接显示 IP 地址，不进行 DNS 反向解析。 | 加快启动速度，或者当 DNS 解析有问题时。 |
| `-T` \<br\> `--tcp` | 使用 TCP SYN 包代替标准的 ICMP 包进行探测。 | **非常有用！** 当路径上的防火墙**拦截了 ICMP (ping) 包**，但允许 TCP 流量通过时。 |
| `-P PORT` \<br\> `--port PORT` | 结合 `-T` (TCP) 或 `-U` (UDP) 使用，指定目标端口。 | 需要探测特定服务端口的连通性时，如 `-T -P 443` 探测 HTTPS 端口。 |

-----

### **`gping` - 图形化 Ping 工具**

`gping` 用漂亮的图表来展示延迟，非常直观。

#### **1. 基础用法**

对单个目标进行图形化 ping：

```bash
gping google.com
```

#### **2. 监控多个目标**

这是 `gping` 的一个亮点，可以同时监控多个目标的延迟并在同一张图上对比：

```bash
gping google.com 8.8.8.8 1.1.1.1
```

#### **3. 常用命令行选项**

| 选项 | 说明 | 示例 |
| :--- | :--- | :--- |
| `-c COUNT` \<br\> `--count COUNT` | 指定发送数据包的数量后自动退出。 | `gping -c 10 google.com` |
| `--cmd COMMAND` | 监控执行一个命令的延迟。 | **Pro Tip\!** `gping --cmd "apt update"` |
| `-i SECONDS` \<br\> `--interval SECONDS` | 设置发送数据包的间隔秒数。 | `gping -i 3 google.com` |
| `-b BYTES` \<br\> `--buffer BYTES` | 设置发送数据包的大小（字节）。 | `gping -b 128 google.com` |

-----

### **💡 总结与建议**

  * **日常快速查看延迟**：直接用 `gping <host>`，直观又好看。
  * **发现网络卡顿或丢包**：立即使用 `mtr <host>`，让它运行一两分钟，观察 `Loss%` 和 `Avg` 延迟，快速定位问题节点。
  * **需要向别人报告问题**：使用 `mtr -r -c 50 <host>` 生成一份清晰的报告，复制粘贴给网络管理员或客服。
  * **Ping 不通但服务可用**：尝试 `mtr -T -P <端口号> <host>`，看看是不是 ICMP 被墙了。
